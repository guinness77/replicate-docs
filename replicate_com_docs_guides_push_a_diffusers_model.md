Docs

Search documentation`âŒ˜K`

Get started

Collapse sidebar

[Run a model from Node.js](https://replicate.com/docs/get-started/nodejs) [Run a model from Google Colab](https://replicate.com/docs/get-started/google-colab) [Run a model from Python](https://replicate.com/docs/get-started/python) [Fine-tune an image model](https://replicate.com/docs/get-started/fine-tune-with-flux)

Guides

[Build a website with Next.js](https://replicate.com/docs/guides/nextjs) [Build a Discord bot with Python](https://replicate.com/docs/guides/discord-bot) [Build an app with SwiftUI](https://replicate.com/docs/guides/swiftui) [Cache images with Cloudflare](https://replicate.com/docs/guides/cloudflare-image-cache) [Use realtime speech with OpenAI](https://replicate.com/docs/guides/openai-realtime) [Push your own model](https://replicate.com/docs/guides/push-a-model) [Push a Diffusers model](https://replicate.com/docs/guides/push-a-diffusers-model) [Push a Transformers model](https://replicate.com/docs/guides/push-a-transformers-model) [Handle webhooks with Val Town](https://replicate.com/docs/guides/build-a-webhook-notifier-with-val-town) [Deploy a custom model](https://replicate.com/docs/guides/deploy-a-custom-model) [Push a model using GitHub Actions](https://replicate.com/docs/guides/push-a-model-using-github-actions) [Set up a CI/CD pipeline](https://replicate.com/docs/guides/continuous-model-deployment) [Get a GPU on Brev](https://replicate.com/docs/guides/get-a-gpu-on-brev) [Get a GPU on Lambda Labs](https://replicate.com/docs/guides/get-a-gpu-on-lambda-labs) [Working with LoRAs](https://replicate.com/docs/guides/working-with-loras)

ComfyUI

[Craft generative AI workflows with ComfyUI](https://replicate.com/docs/guides/comfyui) [Use ComfyUI manager](https://replicate.com/docs/guides/comfyui/comfyui-manager) [Start by running the ComfyUI examples](https://replicate.com/docs/guides/comfyui/examples) [Popular ComfyUI custom nodes](https://replicate.com/docs/guides/comfyui/custom-nodes) [Run your ComfyUI workflow on Replicate](https://replicate.com/docs/guides/comfyui/run-comfyui-on-replicate) [Run ComfyUI with an API](https://replicate.com/docs/guides/comfyui/run-comfyui-with-an-api)

Hypermedia

[Build AI apps fast with hypermedia](https://replicate.com/docs/guides/hypermedia) [What is hypermedia, and why use it for AI apps?](https://replicate.com/docs/guides/hypermedia/what-is-hypermedia) [Building a face swapping app with Val Town, HTMX, and Replicate](https://replicate.com/docs/guides/hypermedia/build-hypermedia-app)

Instant ID

[Make images of real people instantly with InstantID](https://replicate.com/docs/guides/instant-id) [Run InstantID with an API](https://replicate.com/docs/guides/instant-id/run-instant-id-with-an-api)

Language models

[Prompt and run open-source large language models (LLMs)](https://replicate.com/docs/guides/language-models) [How to use open source language models](https://replicate.com/docs/guides/language-models/how-to-use) [Use cases for open source language models](https://replicate.com/docs/guides/language-models/use-cases) [Popular open source language models and their use cases](https://replicate.com/docs/guides/language-models/popular-models) [How to prompt open source large language models](https://replicate.com/docs/guides/language-models/how-to-prompt) [Advanced prompting for open source large language models](https://replicate.com/docs/guides/language-models/advanced-prompting)

Llava

[Talk to images with Llava 13B](https://replicate.com/docs/guides/llava)

Model best practices

[Best practices for Replicate models](https://replicate.com/docs/guides/model-best-practices)

Photomaker

[Generate photos of real people with Photomaker](https://replicate.com/docs/guides/photomaker)

Stable Diffusion

[Make art with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion) [How to use Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/how-to-use) [Image to image (img2img) with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/image-to-image) [Inpainting with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/inpainting) [Outpainting with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/outpainting) [Fine-tuning Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/fine-tuning) [Using ControlNet with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/controlnet) [Fast Stable Diffusion: Turbo and latent consistency models (LCMs)](https://replicate.com/docs/guides/stable-diffusion/turbo-and-latent-consistency) [A to Z of Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/glossary)

Upscaling images

[Upscale images with AI models](https://replicate.com/docs/guides/upscaling-images) [Upscaling images with Real-ESRGAN](https://replicate.com/docs/guides/upscaling-images/real-esrgan) [Fixing faces with GFPGAN and Codeformer](https://replicate.com/docs/guides/upscaling-images/gfpgan-and-codeformer) [Upscaling images with SwinIR](https://replicate.com/docs/guides/upscaling-images/swinir) [Upscaling images with ControlNet tile](https://replicate.com/docs/guides/upscaling-images/controlnet-tile) [Upscaling images with Ultimate SD Upscale](https://replicate.com/docs/guides/upscaling-images/sd-ultimate-upscale)

Whisper

[Turn speech to text with WhisperX](https://replicate.com/docs/guides/whisper) [Run WhisperX with an API](https://replicate.com/docs/guides/whisper/run-whisperx-with-an-api)

Topics

Models

[About models](https://replicate.com/docs/topics/models) [Run a model](https://replicate.com/docs/topics/models/run-a-model) [Create a model](https://replicate.com/docs/topics/models/create-a-model) [Publish a model](https://replicate.com/docs/topics/models/publish-a-model) [Model versions](https://replicate.com/docs/topics/models/versions) [Model hardware](https://replicate.com/docs/topics/models/hardware) [Private and public models](https://replicate.com/docs/topics/models/private-models) [Training destinations](https://replicate.com/docs/topics/models/models-as-training-destinations) [Delete a model](https://replicate.com/docs/topics/models/delete-a-model)

Predictions

[About predictions](https://replicate.com/docs/topics/predictions) [Create a prediction](https://replicate.com/docs/topics/predictions/create-a-prediction) [Input files](https://replicate.com/docs/topics/predictions/input-files) [Output files](https://replicate.com/docs/topics/predictions/output-files) [Prediction lifecycle](https://replicate.com/docs/topics/predictions/lifecycle) [Share a prediction](https://replicate.com/docs/topics/predictions/share-a-prediction) [Rate limits](https://replicate.com/docs/topics/predictions/rate-limits) [Safety checking](https://replicate.com/docs/topics/predictions/safety-checking) [Data retention](https://replicate.com/docs/topics/predictions/data-retention) [Streaming output](https://replicate.com/docs/topics/predictions/streaming)

Deployments

[About deployments](https://replicate.com/docs/topics/deployments) [Create a deployment](https://replicate.com/docs/topics/deployments/create-a-deployment) [View deployments](https://replicate.com/docs/topics/deployments/view-deployments) [Delete a deployment](https://replicate.com/docs/topics/deployments/delete-a-deployment)

Webhooks

[About webhooks](https://replicate.com/docs/topics/webhooks) [Set up webhooks](https://replicate.com/docs/topics/webhooks/setup-webhook) [Receive webhooks](https://replicate.com/docs/topics/webhooks/receive-webhook) [Verify webhooks](https://replicate.com/docs/topics/webhooks/verify-webhook) [Test your webhook code](https://replicate.com/docs/topics/webhooks/testing-webhook-code)

Organizations

[About organizations](https://replicate.com/docs/topics/organizations)

Billing

[About billing](https://replicate.com/docs/topics/billing)

Site policy

[About subprocessors](https://replicate.com/docs/topics/site-policy/subprocessors)

Reference

[How does Replicate work?](https://replicate.com/docs/reference/how-does-replicate-work) [Client libraries](https://replicate.com/docs/reference/client-libraries) [HTTP API](https://replicate.com/docs/reference/http) [OpenAPI schema](https://replicate.com/docs/reference/openapi) [Open source](https://replicate.com/docs/reference/open-source)

Learn how to push a [Diffusers](https://huggingface.co/docs/diffusers) image generation model to Replicate as a scalable API.

## [Anchor for intro](https://replicate.com/docs/guides/push-a-diffusers-model\#intro) Intro

[Diffusers](https://huggingface.co/docs/diffusers) is an open-source Python library that provides a consistent interface for using diffusion models for image generation, the most popular of which is Stable Diffusion.

There are lots of ways to use Stable Diffusion: You can [run it from your browser](https://replicate.com/stability-ai/stable-diffusion) on Replicate's website, or [run it from your code](https://replicate.com/stability-ai/stable-diffusion/api) using Replicate's API. You can even [run it on your own machine](https://replicate.com/blog/run-stable-diffusion-on-m1-mac).

But what if you want to customize the model? There are a lot of things you might want to change:

- **Use custom/pretrained weights or styles.** There are lots of variants of Stable Diffusion trained on different styles of images, like [OpenJourney](https://huggingface.co/prompthero/openjourney-v2), [Analog Diffusion](https://huggingface.co/wavymulder/Analog-Diffusion), and [Realistic Vision](https://huggingface.co/SG161222/Realistic_Vision_V1.4).
- **Use a different image format.** Stable Diffusion returns an uncompressed PNG by default, but you might want to also return a compressed JPEG or WebP image.
- **Generate a batch of outputs.** You could update the prompt input to accept a delimited string of multiple values and generate a batch of 200 images at once to reduce API call overhead.
- **Remove some inputs you don't care about.** Many machine learning models have a lot of inputs, but you might only care about a few of them. You could remove the ones you don't care about, and make the model easier to use. For an example of this, see [lora-training](https://replicate.com/cloneofsimo/lora-training) and [lora-advanced-training](https://replicate.com/cloneofsimo/lora-advanced-training).
- **Change the scheduler.** Schedulers give you a way to configure a speed-vs-quality tradeoff in your model.

In this guide we'll walk you through the steps to create your own model, so you can make these kinds of changes and push them to Replicate as your own public or private model with a stable API.

## [Anchor for prerequisites](https://replicate.com/docs/guides/push-a-diffusers-model\#prerequisites) Prerequisites

To follow this guide, you'll need:

- **An account on Replicate.**
- **Docker.** You'll be using the Cog command-line tool to build and push your model. Cog uses Docker to create a container for your model. You'll need to [install and start Docker](https://docs.docker.com/get-docker/) before you can run Cog. You can confirm Docker is running by typing `docker info` in your terminal.

## [Anchor for step-1-create-a-model](https://replicate.com/docs/guides/push-a-diffusers-model\#step-1-create-a-model) Step 1: Create a model

First, create a model on Replicate at [replicate.com/create](https://replicate.com/create?purpose=fine-tune-image). If you haven't used Replicate before, you'll need to sign in with your GitHub account. You can configure the model to be private so that only you can use it, or public so anyone can use it.

[![](https://user-images.githubusercontent.com/2289/222594676-ecb72c3e-1fb4-4ed5-b368-1a82afc46f3b.png)](https://replicate.com/create?purpose=fine-tune-image)

## [Anchor for step-2-clone-the-stable-diffusion-repo](https://replicate.com/docs/guides/push-a-diffusers-model\#step-2-clone-the-stable-diffusion-repo) Step 2: Clone the Stable Diffusion repo

Replicate maintains an open-source Stable Diffusion repo on GitHub at [replicate/cog-stable-diffusion](https://github.com/replicate/cog-stable-diffusion).

Create your own fork of the repo on GitHub, or clone the repo directly:

Copy

```
git clone https://github.com/replicate/cog-stable-diffusion
cd cog-stable-diffusion
```

This repo is fairly small, and contains two noteworthy files:

- `cog.yaml` \- Defines the CUDA and Python versions, and dependencies for the model. This file tells Cog how to package the model.
- `predict.py` \- Defines the inputs and outputs of the model, and the code to run the model. The Stable Diffusion model itself is imported through the Python [`diffusers`](https://pypi.org/project/diffusers/) library.

## [Anchor for step-3-install-cog](https://replicate.com/docs/guides/push-a-diffusers-model\#step-3-install-cog) Step 3: Install Cog

[Cog](https://cog.run/) is an open source tool that makes it easy to put a machine learning model in a Docker container. Run the following commands to install it and set the correct permissions:

Copy

```
curl https://replicate.github.io/codespaces/scripts/install-cog.sh | bash
```

Confirm that Cog is installed by running `cog --version`:

Copy

```
cog --version
# cog version 0.9.25 (built 2024-10-07T15:11:47Z)
```

## [Anchor for step-4-customize-your-model](https://replicate.com/docs/guides/push-a-diffusers-model\#step-4-customize-your-model) Step 4: Customize your model

The repo you cloned is configured to build Stable Diffusion 2.1 by default, but you can customize it to use any [diffusers-compatible model](https://huggingface.co/models?library=fine-tune-image), including trained models like [OpenJourney](https://huggingface.co/prompthero/openjourney-v2), [Analog Diffusion](https://huggingface.co/wavymulder/Analog-Diffusion), and [Realistic Vision](https://huggingface.co/SG161222/Realistic_Vision_V1.4).

To use a different model, open `predict.py` and change the value of `MODEL_ID` to a shorthand `{owner}/{repo}` string that corresponds to a diffusers-compatible model on Hugging Face:

Copy

```
MODEL_ID = "wavymulder/Analog-Diffusion"
```

If you just want to use a different pretrained model, this is the only change that's needed.

If you want to make other changes to your model's behavior, take a look at [`predict.py`](https://github.com/replicate/cog-stable-diffusion/blob/38510524cf4f3dc679e5945ebb52feb40d52c1a9/predict.py), which is the Python interface that defines the inputs and outputs for your model.

## [Anchor for step-5-download-weights](https://replicate.com/docs/guides/push-a-diffusers-model\#step-5-download-weights) Step 5: Download weights

Now that you've configured your model, it's time to download the weights:

Copy

```
cog run script/download-weights
```

This process will take a few minutes but you'll only need to run it once, as it will cache the downloaded dependencies on disk. Get up and stretch, grab yourself a snack, or use this opportunity to add metadata to the model page you created on Replicate in Step 1 by adding a title, README, GitHub repository URL, etc.

## [Anchor for step-6-run-your-model](https://replicate.com/docs/guides/push-a-diffusers-model\#step-6-run-your-model) Step 6: Run your model

Now that you've downloaded the weights, you can run the model locally with Cog:

Copy

```
cog predict -i prompt="monkey scuba diving" -i width=512  -i height=512
```

This will run the model locally and return the output image. You can change the prompt, width, and height to see how the model responds to different inputs. Note that larger dimensions require more VRAM, so 512x512 is a sensible default.

## [Anchor for step-7-push-your-model](https://replicate.com/docs/guides/push-a-diffusers-model\#step-7-push-your-model) Step 7: Push your model

Now that you've customized your model, it's time to push it to Replicate.

First you'll need to authenticate:

Copy

```
cog login
```

Then push your model using the name you specified in Step 1:

Copy

```
cog push r8.im/<your-username>/<your-model-name>
```

## [Anchor for step-8-use-your-model](https://replicate.com/docs/guides/push-a-diffusers-model\#step-8-use-your-model) Step 8: Use your model

Your model is now live! ðŸš€

You can run the model from the website by clicking the "Demo" tab on the model page, or you can use the HTTP API to run the model from your own code.

Click the "API" tab on your model page to see example code for running the model:

![](https://user-images.githubusercontent.com/2289/222592355-ec880478-fa5c-470b-bf90-512cd0b1247f.png)

## [Anchor for next-steps](https://replicate.com/docs/guides/push-a-diffusers-model\#next-steps) Next steps

Now that you have your own model, see what else you can do with it.

If you need inspiration or guidance, jump into our [Discord](https://discord.gg/replicate).

[Next:Push a Transformers model](https://replicate.com/docs/guides/push-a-transformers-model)

# Docs

Get started

Collapse sidebar

[Run a model from Node.js](https://replicate.com/docs/get-started/nodejs) [Run a model from Google Colab](https://replicate.com/docs/get-started/google-colab) [Run a model from Python](https://replicate.com/docs/get-started/python) [Fine-tune an image model](https://replicate.com/docs/get-started/fine-tune-with-flux)

Guides

[Build a website with Next.js](https://replicate.com/docs/guides/nextjs) [Build a Discord bot with Python](https://replicate.com/docs/guides/discord-bot) [Build an app with SwiftUI](https://replicate.com/docs/guides/swiftui) [Cache images with Cloudflare](https://replicate.com/docs/guides/cloudflare-image-cache) [Use realtime speech with OpenAI](https://replicate.com/docs/guides/openai-realtime) [Push your own model](https://replicate.com/docs/guides/push-a-model) [Push a Diffusers model](https://replicate.com/docs/guides/push-a-diffusers-model) [Push a Transformers model](https://replicate.com/docs/guides/push-a-transformers-model) [Handle webhooks with Val Town](https://replicate.com/docs/guides/build-a-webhook-notifier-with-val-town) [Deploy a custom model](https://replicate.com/docs/guides/deploy-a-custom-model) [Push a model using GitHub Actions](https://replicate.com/docs/guides/push-a-model-using-github-actions) [Set up a CI/CD pipeline](https://replicate.com/docs/guides/continuous-model-deployment) [Get a GPU on Brev](https://replicate.com/docs/guides/get-a-gpu-on-brev) [Get a GPU on Lambda Labs](https://replicate.com/docs/guides/get-a-gpu-on-lambda-labs) [Working with LoRAs](https://replicate.com/docs/guides/working-with-loras)

ComfyUI

[Craft generative AI workflows with ComfyUI](https://replicate.com/docs/guides/comfyui) [Use ComfyUI manager](https://replicate.com/docs/guides/comfyui/comfyui-manager) [Start by running the ComfyUI examples](https://replicate.com/docs/guides/comfyui/examples) [Popular ComfyUI custom nodes](https://replicate.com/docs/guides/comfyui/custom-nodes) [Run your ComfyUI workflow on Replicate](https://replicate.com/docs/guides/comfyui/run-comfyui-on-replicate) [Run ComfyUI with an API](https://replicate.com/docs/guides/comfyui/run-comfyui-with-an-api)

Hypermedia

[Build AI apps fast with hypermedia](https://replicate.com/docs/guides/hypermedia) [What is hypermedia, and why use it for AI apps?](https://replicate.com/docs/guides/hypermedia/what-is-hypermedia) [Building a face swapping app with Val Town, HTMX, and Replicate](https://replicate.com/docs/guides/hypermedia/build-hypermedia-app)

Instant ID

[Make images of real people instantly with InstantID](https://replicate.com/docs/guides/instant-id) [Run InstantID with an API](https://replicate.com/docs/guides/instant-id/run-instant-id-with-an-api)

Language models

[Prompt and run open-source large language models (LLMs)](https://replicate.com/docs/guides/language-models) [How to use open source language models](https://replicate.com/docs/guides/language-models/how-to-use) [Use cases for open source language models](https://replicate.com/docs/guides/language-models/use-cases) [Popular open source language models and their use cases](https://replicate.com/docs/guides/language-models/popular-models) [How to prompt open source large language models](https://replicate.com/docs/guides/language-models/how-to-prompt) [Advanced prompting for open source large language models](https://replicate.com/docs/guides/language-models/advanced-prompting)

Llava

[Talk to images with Llava 13B](https://replicate.com/docs/guides/llava)

Model best practices

[Best practices for Replicate models](https://replicate.com/docs/guides/model-best-practices)

Photomaker

[Generate photos of real people with Photomaker](https://replicate.com/docs/guides/photomaker)

Stable Diffusion

[Make art with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion) [How to use Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/how-to-use) [Image to image (img2img) with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/image-to-image) [Inpainting with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/inpainting) [Outpainting with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/outpainting) [Fine-tuning Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/fine-tuning) [Using ControlNet with Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/controlnet) [Fast Stable Diffusion: Turbo and latent consistency models (LCMs)](https://replicate.com/docs/guides/stable-diffusion/turbo-and-latent-consistency) [A to Z of Stable Diffusion](https://replicate.com/docs/guides/stable-diffusion/glossary)

Upscaling images

[Upscale images with AI models](https://replicate.com/docs/guides/upscaling-images) [Upscaling images with Real-ESRGAN](https://replicate.com/docs/guides/upscaling-images/real-esrgan) [Fixing faces with GFPGAN and Codeformer](https://replicate.com/docs/guides/upscaling-images/gfpgan-and-codeformer) [Upscaling images with SwinIR](https://replicate.com/docs/guides/upscaling-images/swinir) [Upscaling images with ControlNet tile](https://replicate.com/docs/guides/upscaling-images/controlnet-tile) [Upscaling images with Ultimate SD Upscale](https://replicate.com/docs/guides/upscaling-images/sd-ultimate-upscale)

Whisper

[Turn speech to text with WhisperX](https://replicate.com/docs/guides/whisper) [Run WhisperX with an API](https://replicate.com/docs/guides/whisper/run-whisperx-with-an-api)

Topics

Models

[About models](https://replicate.com/docs/topics/models) [Run a model](https://replicate.com/docs/topics/models/run-a-model) [Create a model](https://replicate.com/docs/topics/models/create-a-model) [Publish a model](https://replicate.com/docs/topics/models/publish-a-model) [Model versions](https://replicate.com/docs/topics/models/versions) [Model hardware](https://replicate.com/docs/topics/models/hardware) [Private and public models](https://replicate.com/docs/topics/models/private-models) [Training destinations](https://replicate.com/docs/topics/models/models-as-training-destinations) [Delete a model](https://replicate.com/docs/topics/models/delete-a-model)

Predictions

[About predictions](https://replicate.com/docs/topics/predictions) [Create a prediction](https://replicate.com/docs/topics/predictions/create-a-prediction) [Input files](https://replicate.com/docs/topics/predictions/input-files) [Output files](https://replicate.com/docs/topics/predictions/output-files) [Prediction lifecycle](https://replicate.com/docs/topics/predictions/lifecycle) [Share a prediction](https://replicate.com/docs/topics/predictions/share-a-prediction) [Rate limits](https://replicate.com/docs/topics/predictions/rate-limits) [Safety checking](https://replicate.com/docs/topics/predictions/safety-checking) [Data retention](https://replicate.com/docs/topics/predictions/data-retention) [Streaming output](https://replicate.com/docs/topics/predictions/streaming)

Deployments

[About deployments](https://replicate.com/docs/topics/deployments) [Create a deployment](https://replicate.com/docs/topics/deployments/create-a-deployment) [View deployments](https://replicate.com/docs/topics/deployments/view-deployments) [Delete a deployment](https://replicate.com/docs/topics/deployments/delete-a-deployment)

Webhooks

[About webhooks](https://replicate.com/docs/topics/webhooks) [Set up webhooks](https://replicate.com/docs/topics/webhooks/setup-webhook) [Receive webhooks](https://replicate.com/docs/topics/webhooks/receive-webhook) [Verify webhooks](https://replicate.com/docs/topics/webhooks/verify-webhook) [Test your webhook code](https://replicate.com/docs/topics/webhooks/testing-webhook-code)

Organizations

[About organizations](https://replicate.com/docs/topics/organizations)

Billing

[About billing](https://replicate.com/docs/topics/billing)

Site policy

[About subprocessors](https://replicate.com/docs/topics/site-policy/subprocessors)

Reference

[How does Replicate work?](https://replicate.com/docs/reference/how-does-replicate-work) [Client libraries](https://replicate.com/docs/reference/client-libraries) [HTTP API](https://replicate.com/docs/reference/http) [OpenAPI schema](https://replicate.com/docs/reference/openapi) [Open source](https://replicate.com/docs/reference/open-source)

Close

Popular searches on Replicate

- [Run a model from Node.js](https://replicate.com/docs/get-started/nodejs)
- [Deploy a custom model](https://replicate.com/docs/guides/deploy-a-custom-model)
- [How does Replicate work?](https://replicate.com/docs/reference/how-does-replicate-work)

Showing 0 results